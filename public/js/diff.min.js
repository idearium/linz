var JsDiff=function(){function e(e){return{newPos:e.newPos,components:e.components.slice(0)}}function t(e){var t=[];for(var n=0;n<e.length;n++){if(e[n]){t.push(e[n])}}return t}function n(e){var t=e;t=t.replace(/&/g,"&");t=t.replace(/</g,"&lt;");t=t.replace(/>/g,"&gt;");t=t.replace(/"/g,"&quot;");return t}var r=function(e){this.ignoreWhitespace=e};r.prototype={diff:function(t,n){if(n===t){return[{value:n}]}if(!n){return[{value:t,removed:true}]}if(!t){return[{value:n,added:true}]}n=this.tokenize(n);t=this.tokenize(t);var r=n.length,i=t.length;var s=r+i;var o=[{newPos:-1,components:[]}];var u=this.extractCommon(o[0],n,t,0);if(o[0].newPos+1>=r&&u+1>=i){return o[0].components}for(var a=1;a<=s;a++){for(var f=-1*a;f<=a;f+=2){var l;var c=o[f-1],h=o[f+1];u=(h?h.newPos:0)-f;if(c){o[f-1]=undefined}var p=c&&c.newPos+1<r;var d=h&&0<=u&&u<i;if(!p&&!d){o[f]=undefined;continue}if(!p||d&&c.newPos<h.newPos){l=e(h);this.pushComponent(l.components,t[u],undefined,true)}else{l=e(c);l.newPos++;this.pushComponent(l.components,n[l.newPos],true,undefined)}var u=this.extractCommon(l,n,t,f);if(l.newPos+1>=r&&u+1>=i){return l.components}else{o[f]=l}}}},pushComponent:function(e,t,n,r){var i=e[e.length-1];if(i&&i.added===n&&i.removed===r){e[e.length-1]={value:this.join(i.value,t),added:n,removed:r}}else{e.push({value:t,added:n,removed:r})}},extractCommon:function(e,t,n,r){var i=t.length,s=n.length,o=e.newPos,u=o-r;while(o+1<i&&u+1<s&&this.equals(t[o+1],n[u+1])){o++;u++;this.pushComponent(e.components,t[o],undefined,undefined)}e.newPos=o;return u},equals:function(e,t){var n=/\S/;if(this.ignoreWhitespace&&!n.test(e)&&!n.test(t)){return true}else{return e===t}},join:function(e,t){return e+t},tokenize:function(e){return e}};var i=new r;var s=new r(true);var o=new r;s.tokenize=o.tokenize=function(e){return t(e.split(/(\s+|\b)/))};var u=new r(true);u.tokenize=function(e){return t(e.split(/([{}:;,]|\s+)/))};var a=new r;a.tokenize=function(e){var t=[],n=e.split(/^/m);for(var r=0;r<n.length;r++){var i=n[r],s=n[r-1];if(i=="\n"&&s&&s[s.length-1]==="\r"){t[t.length-1]+="\n"}else if(i){t.push(i)}}return t};return{Diff:r,diffChars:function(e,t){return i.diff(e,t)},diffWords:function(e,t){return s.diff(e,t)},diffWordsWithSpace:function(e,t){return o.diff(e,t)},diffLines:function(e,t){return a.diff(e,t)},diffCss:function(e,t){return u.diff(e,t)},createPatch:function(e,t,n,r,i){function u(e){return e.map(function(e){return" "+e})}function f(e,t,n){var r=o[o.length-2],i=t===o.length-2,s=t===o.length-3&&(n.added!==r.added||n.removed!==r.removed);if(!/\n$/.test(n.value)&&(i||s)){e.push("\\ No newline at end of file")}}var s=[];s.push("Index: "+e);s.push("===================================================================");s.push("--- "+e+(typeof r==="undefined"?"":"  "+r));s.push("+++ "+e+(typeof i==="undefined"?"":"  "+i));var o=a.diff(t,n);if(!o[o.length-1].value){o.pop()}o.push({value:"",lines:[]});var l=0,c=0,h=[],p=1,d=1;for(var v=0;v<o.length;v++){var m=o[v],g=m.lines||m.value.replace(/\n$/,"").split("\n");m.lines=g;if(m.added||m.removed){if(!l){var y=o[v-1];l=p;c=d;if(y){h=u(y.lines.slice(-4));l-=h.length;c-=h.length}}h.push.apply(h,g.map(function(e){return(m.added?"+":"-")+e}));f(h,v,m);if(m.added){d+=g.length}else{p+=g.length}}else{if(l){if(g.length<=8&&v<o.length-2){h.push.apply(h,u(g))}else{var b=Math.min(g.length,4);s.push("@@ -"+l+","+(p-l+b)+" +"+c+","+(d-c+b)+" @@");s.push.apply(s,h);s.push.apply(s,u(g.slice(0,b)));if(g.length<=4){f(s,v,m)}l=0;c=0;h=[]}}p+=g.length;d+=g.length}}return s.join("\n")+"\n"},applyPatch:function(e,t){var n=t.split("\n");var r=[];var i=false,s=false;for(var o=n[0][0]==="I"?4:0;o<n.length;o++){if(n[o][0]==="@"){var u=n[o].split(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);r.unshift({start:u[3],oldlength:u[2],oldlines:[],newlength:u[4],newlines:[]})}else if(n[o][0]==="+"){r[0].newlines.push(n[o].substr(1))}else if(n[o][0]==="-"){r[0].oldlines.push(n[o].substr(1))}else if(n[o][0]===" "){r[0].newlines.push(n[o].substr(1));r[0].oldlines.push(n[o].substr(1))}else if(n[o][0]==="\\"){if(n[o-1][0]==="+"){i=true}else if(n[o-1][0]==="-"){s=true}}}var a=e.split("\n");for(var o=r.length-1;o>=0;o--){var f=r[o];for(var l=0;l<f.oldlength;l++){if(a[f.start-1+l]!==f.oldlines[l]){return false}}Array.prototype.splice.apply(a,[f.start-1,+f.oldlength].concat(f.newlines))}if(i){while(!a[a.length-1]){a.pop()}}else if(s){a.push("")}return a.join("\n")},convertChangesToXML:function(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];if(i.added){t.push("<ins>")}else if(i.removed){t.push("<del>")}t.push(n(i.value));if(i.added){t.push("</ins>")}else if(i.removed){t.push("</del>")}}return t.join("")},convertChangesToDMP:function(e){var t=[],n;for(var r=0;r<e.length;r++){n=e[r];t.push([n.added?1:n.removed?-1:0,n.value])}return t}}}();if(typeof module!=="undefined"){module.exports=JsDiff}
